import{j as e}from"./app-rRRUV2cB.js";import{C as H,a as q,b as E,d as z,c as G}from"./card-CHMFiD5G.js";import{b as C,e as m,T as J,a as K,c as p,d as L}from"./table-BIo26idD.js";import{T as N,a as M,b as F}from"./tooltip-niLrPZi8.js";import"./utils-jAU0Cazi.js";import"./index-DQlWsysT.js";import"./index-qwbW2JBJ.js";import"./floating-ui.react-dom-DYtrpicJ.js";const ae=({enrollment:i,months:u,title:_="Installment Plan",description:D="Monthly billing installment status with discounts and payments."})=>{var j;const r=new Date().getMonth()+1;let x=0;const o=n=>n>=6?n:n+12,A=i.billing_items.map(n=>{var v,w;const{month_installment:c,start_month:b,end_month:P}=n.pivot;if(!c||!b||!P)return null;const d=((v=n.category)==null?void 0:v.name)??"—",y=parseFloat(n.amount)*n.pivot.quantity,B=i.billing_discounts.filter(t=>t.category.name===d).reduce((t,a)=>{const s=parseFloat(a.amount);return a.value==="fixed"?t+s:a.value==="percentage"?t+y*(s/100):t},0),k=y-B,h=i.payments.filter(t=>{var a,s;return((s=(a=t.billing)==null?void 0:a.category)==null?void 0:s.name)===d&&t.remarks==="down_payment"}).reduce((t,a)=>t+parseFloat(a.amount),0),I=Math.max(k-h,0)/c,O=Array.from({length:c},(t,a)=>(b-1+a)%12+1);let g=i.payments.filter(t=>{var a,s;return((s=(a=t.billing)==null?void 0:a.category)==null?void 0:s.name)===d&&t.remarks!=="down_payment"}).sort((t,a)=>new Date(t.payment_date).getTime()-new Date(a.payment_date).getTime()).reduce((t,a)=>t+parseFloat(a.amount),0);const l={};let f=0;for(const t of O){const a=I+f,s=Math.min(a,g);g-=s,f=a-s,l[t]={due:Number(a.toFixed(2)),balance:Number(Math.max(a-s,0).toFixed(2))}}const R=o(r),T=Object.keys(l).map(Number).sort((t,a)=>o(t)-o(a));if(l[r])x+=l[r].balance;else{const t=T[T.length-1];R>o(t)&&(x+=((w=l[t])==null?void 0:w.balance)||0)}return e.jsxs(C,{children:[e.jsx(m,{children:d}),e.jsx(m,{children:c}),u.map(t=>{const a=l[t.value],s=t.value===r;return a?e.jsx(m,{className:s?"bg-yellow-100 dark:bg-yellow-800/40 font-semibold":"",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs(N,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("div",{className:"text-green-600 font-medium cursor-help",children:["₱",a.due.toFixed(2)]})}),e.jsx(F,{children:e.jsx("p",{children:"Due this month"})})]}),e.jsxs(N,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("div",{className:a.balance>0?"text-red-600 font-medium cursor-help":"text-gray-400 cursor-help",children:["₱",a.balance.toFixed(2)]})}),e.jsxs(F,{children:[e.jsx("p",{children:"Remaining balance"}),h>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["₱",h.toFixed(2)," ","down payment applied"]})]})]})]})},t.value):e.jsx(m,{children:"—"},t.value)})]},n.id)});return e.jsxs(H,{children:[e.jsxs(q,{children:[e.jsx(E,{children:_}),e.jsx(z,{children:D})]}),e.jsxs(G,{className:"overflow-auto",children:[e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(C,{children:[e.jsx(p,{children:"Item"}),e.jsx(p,{children:"Installments"}),u.map(n=>e.jsx(p,{children:n.label},n.value))]})}),e.jsx(L,{children:A})]}),e.jsx("div",{className:"mt-6 text-right",children:e.jsxs("p",{className:"text-md font-semibold",children:["Total Due for"," ",(j=u.find(n=>n.value===r))==null?void 0:j.label,":"," ",e.jsxs("span",{className:"text-primary",children:["₱",x.toFixed(2)]})]})})]})]})};export{ae as InstallmentPlanTable};
