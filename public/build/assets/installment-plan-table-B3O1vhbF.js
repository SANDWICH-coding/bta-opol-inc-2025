import{j as e}from"./app-Cl5YLaWy.js";import{C as R,a as q,b as E,d as G,c as U}from"./card-Cumxlg5F.js";import{b as N,e as h,T as z,a as J,c as b,d as K}from"./table-DtEmn1v2.js";import{T as M,a as _,b as D}from"./tooltip-C6F99bXP.js";import"./utils-jAU0Cazi.js";import"./index-BjFNjnDZ.js";import"./index-qKjcTZ5C.js";import"./floating-ui.react-dom-kMN8wKD0.js";const ae=({enrollment:o,months:x,title:F="Installment Plan",description:B="Monthly billing installment status with discounts and payments."})=>{var y;const l=new Date().getMonth()+1;let u=0;const I=o.billing_items.map(s=>{var C,w;const{month_installment:c,start_month:f,end_month:P}=s.pivot;if(!c||!f||!P)return null;const d=(C=s.category)==null?void 0:C.name,g=parseFloat(s.amount)*s.pivot.quantity,A=o.billing_discounts.filter(t=>t.category.name===d).reduce((t,a)=>{const n=parseFloat(a.amount);return a.value==="fixed"?t+n:a.value==="percentage"?t+g*(n/100):t},0),k=g-A,p=o.payments.filter(t=>{var a,n;return((n=(a=t.billing)==null?void 0:a.category)==null?void 0:n.name)===d&&t.remarks==="down_payment"}).reduce((t,a)=>t+parseFloat(a.amount),0),H=Math.max(k-p,0)/c,T=Array.from({length:c},(t,a)=>(f-1+a)%12+1);let m=o.payments.filter(t=>{var a,n;return((n=(a=t.billing)==null?void 0:a.category)==null?void 0:n.name)===d&&t.remarks!=="down_payment"}).sort((t,a)=>new Date(t.payment_date).getTime()-new Date(a.payment_date).getTime()).reduce((t,a)=>t+parseFloat(a.amount),0);const r={};let j=0;for(let t=0;t<T.length;t++){const a=T[t],n=H+j;let i=0;m>=n?(i=n,m-=n,j=0):(i=m,j=n-i,m=0);const O=Math.max(n-i,0);r[a]={due:n,balance:O}}const v=6;if(l>=v)if(r[l])u+=r[l].balance;else{const t=Math.max(...Object.keys(r).map(Number));if(t>=v&&l>t){const a=((w=r[t])==null?void 0:w.balance)||0;a>0&&(u+=a)}}return e.jsxs(N,{children:[e.jsx(h,{children:d}),e.jsx(h,{children:c}),x.map(t=>{const a=r[t.value],i=t.value===l?"bg-yellow-100 dark:bg-yellow-800/40 font-semibold":"";return a?e.jsx(h,{className:i,children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs(M,{children:[e.jsx(_,{asChild:!0,children:e.jsxs("div",{className:"text-green-600 font-medium cursor-help",children:["₱",a.due.toFixed(2)]})}),e.jsx(D,{children:e.jsx("p",{children:"Due this month"})})]}),e.jsxs(M,{children:[e.jsx(_,{asChild:!0,children:e.jsxs("div",{className:a.balance>0?"text-red-600 font-medium cursor-help":"text-gray-400 cursor-help",children:["₱",a.balance.toFixed(2)]})}),e.jsxs(D,{children:[e.jsx("p",{children:"Remaining balance"}),p>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["₱",p.toFixed(2)," down payment applied"]})]})]})]})},t.value):e.jsx(h,{children:"—"},t.value)})]},s.id)});return e.jsxs(R,{children:[e.jsxs(q,{children:[e.jsx(E,{children:F}),e.jsx(G,{children:B})]}),e.jsxs(U,{className:"overflow-auto",children:[e.jsxs(z,{children:[e.jsx(J,{children:e.jsxs(N,{children:[e.jsx(b,{children:"Item"}),e.jsx(b,{children:"Installments"}),x.map(s=>e.jsx(b,{children:s.label},s.value))]})}),e.jsx(K,{children:I})]}),e.jsx("div",{className:"mt-6 text-right",children:e.jsxs("p",{className:"text-md font-semibold",children:["Total Due for ",((y=x.find(s=>s.value===l))==null?void 0:y.label)||"this month",":"," ",e.jsxs("span",{className:"text-primary",children:["₱",u.toFixed(2)]})]})})]})]})};export{ae as InstallmentPlanTable};
