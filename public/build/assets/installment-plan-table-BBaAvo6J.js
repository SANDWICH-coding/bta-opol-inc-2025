import{j as e}from"./app-CWAbBtiy.js";import{C as O,a as R,b as k,d as q,c as E}from"./card-CYrEytid.js";import{b as N,e as d,T as G,a as U,c as j,d as z}from"./table-CY0a4SEl.js";import{T as M,a as w,b as _}from"./tooltip-CWUIn_wR.js";import"./utils-jAU0Cazi.js";import"./index-Cr1AGP8Y.js";import"./index-DuKB3EkD.js";const $=({enrollment:m,months:h,title:D="Installment Plan",description:A="Monthly billing installment status with discounts and payments."})=>{var b;const l=new Date().getMonth()+1;let u=0;const F=m.billing_items.map(n=>{var v,C;const{month_installment:o,start_month:f,end_month:I}=n.pivot;if(!o||!f||!I)return null;const x=(v=n.category)==null?void 0:v.name,g=parseFloat(n.amount)*n.pivot.quantity,P=m.billing_discounts.filter(t=>t.category.name===x).reduce((t,a)=>{const s=parseFloat(a.amount);return a.value==="fixed"?t+s:a.value==="percentage"?t+g*(s/100):t},0),B=(g-P)/o,y=Array.from({length:o},(t,a)=>(f-1+a)%12+1);let c=m.payments.filter(t=>{var a,s;return((s=(a=t.billing)==null?void 0:a.category)==null?void 0:s.name)===x}).sort((t,a)=>new Date(t.payment_date).getTime()-new Date(a.payment_date).getTime()).reduce((t,a)=>t+parseFloat(a.amount),0);const r={};let p=0;for(let t=0;t<y.length;t++){const a=y[t],s=B+p;let i=0;c>=s?(i=s,c-=s,p=0):(i=c,p=s-i,c=0);const H=Math.max(s-i,0);r[a]={due:s,balance:H}}const T=6;if(l>=T)if(r[l])u+=r[l].balance;else{const t=Math.max(...Object.keys(r).map(Number));if(t>=T&&l>t){const a=((C=r[t])==null?void 0:C.balance)||0;a>0&&(u+=a)}}return e.jsxs(N,{children:[e.jsx(d,{children:x}),e.jsx(d,{children:o}),h.map(t=>{const a=r[t.value],i=t.value===l?"bg-yellow-100 dark:bg-yellow-800/40 font-semibold":"";return a?e.jsx(d,{className:i,children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs(M,{children:[e.jsx(w,{asChild:!0,children:e.jsxs("div",{className:"text-green-600 font-medium cursor-help",children:["₱",a.due.toFixed(2)]})}),e.jsx(_,{children:e.jsx("p",{children:"Due this month"})})]}),e.jsxs(M,{children:[e.jsx(w,{asChild:!0,children:e.jsxs("div",{className:a.balance>0?"text-red-600 font-medium cursor-help":"text-gray-400 cursor-help",children:["₱",a.balance.toFixed(2)]})}),e.jsx(_,{children:e.jsx("p",{children:"Remaining balance"})})]})]})},t.value):e.jsx(d,{children:"—"},t.value)})]},n.id)});return e.jsxs(O,{children:[e.jsxs(R,{children:[e.jsx(k,{children:D}),e.jsx(q,{children:A})]}),e.jsxs(E,{className:"overflow-auto",children:[e.jsxs(G,{children:[e.jsx(U,{children:e.jsxs(N,{children:[e.jsx(j,{children:"Item"}),e.jsx(j,{children:"Installments"}),h.map(n=>e.jsx(j,{children:n.label},n.value))]})}),e.jsx(z,{children:F})]}),e.jsx("div",{className:"mt-6 text-right",children:e.jsxs("p",{className:"text-md font-semibold",children:["Total Due for ",((b=h.find(n=>n.value===l))==null?void 0:b.label)||"this month",":"," ",e.jsxs("span",{className:"text-primary",children:["₱",u.toFixed(2)]})]})})]})]})};export{$ as InstallmentPlanTable};
