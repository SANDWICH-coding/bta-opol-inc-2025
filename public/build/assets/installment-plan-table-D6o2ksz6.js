import{j as e}from"./app-oyOb_ZaZ.js";import{C as H,a as O,b as q,d as E,c as S}from"./card-ClsxAl-a.js";import{b as C,e as h,T as z,a as G,c as b,d as J}from"./table-CsgkWl1M.js";import{T as N,a as _,b as D}from"./tooltip-BVAC0V1r.js";import"./utils-jAU0Cazi.js";import"./index-DjzhOhRq.js";import"./index-CEzHj2C6.js";import"./floating-ui.react-dom-BLk6X554.js";const te=({enrollment:o,months:u,title:M="Installment Plan",description:F="Monthly billing installment status with discounts and payments."})=>{var y;const i=new Date().getMonth()+1;let x=0;const B=o.billing_items.map(s=>{var v,w;const{month_installment:c,start_month:f,end_month:P}=s.pivot;if(!c||!f||!P)return null;const d=(v=s.category)==null?void 0:v.name,g=parseFloat(s.amount)*s.pivot.quantity,A=o.billing_discounts.filter(t=>t.category.name===d).reduce((t,a)=>{const n=parseFloat(a.amount);return a.value==="fixed"?t+n:a.value==="percentage"?t+g*(n/100):t},0),k=g-A,p=o.payments.filter(t=>{var a,n;return((n=(a=t.billing)==null?void 0:a.category)==null?void 0:n.name)===d&&t.remarks==="down_payment"}).reduce((t,a)=>t+parseFloat(a.amount),0),I=Math.max(k-p,0)/c,T=Array.from({length:c},(t,a)=>(f-1+a)%12+1);let m=o.payments.filter(t=>{var a,n;return((n=(a=t.billing)==null?void 0:a.category)==null?void 0:n.name)===d&&t.remarks!=="down_payment"}).sort((t,a)=>new Date(t.payment_date).getTime()-new Date(a.payment_date).getTime()).reduce((t,a)=>t+parseFloat(a.amount),0);const r={};let j=0;for(let t=0;t<T.length;t++){const a=T[t],n=I+j;let l=0;m>=n?(l=n,m-=n,j=0):(l=m,j=n-l,m=0);const R=Math.max(n-l,0);r[a]={due:n,balance:R}}if(r[i])x+=r[i].balance;else{const t=Object.keys(r).map(Number).sort((n,l)=>n-l),a=t[t.length-1];if(i>a){const n=((w=r[a])==null?void 0:w.balance)||0;n>0&&(x+=n)}}return e.jsxs(C,{children:[e.jsx(h,{children:d}),e.jsx(h,{children:c}),u.map(t=>{const a=r[t.value],l=t.value===i?"bg-yellow-100 dark:bg-yellow-800/40 font-semibold":"";return a?e.jsx(h,{className:l,children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs(N,{children:[e.jsx(_,{asChild:!0,children:e.jsxs("div",{className:"text-green-600 font-medium cursor-help",children:["₱",a.due.toFixed(2)]})}),e.jsx(D,{children:e.jsx("p",{children:"Due this month"})})]}),e.jsxs(N,{children:[e.jsx(_,{asChild:!0,children:e.jsxs("div",{className:a.balance>0?"text-red-600 font-medium cursor-help":"text-gray-400 cursor-help",children:["₱",a.balance.toFixed(2)]})}),e.jsxs(D,{children:[e.jsx("p",{children:"Remaining balance"}),p>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["₱",p.toFixed(2)," down payment applied"]})]})]})]})},t.value):e.jsx(h,{children:"—"},t.value)})]},s.id)});return e.jsxs(H,{children:[e.jsxs(O,{children:[e.jsx(q,{children:M}),e.jsx(E,{children:F})]}),e.jsxs(S,{className:"overflow-auto",children:[e.jsxs(z,{children:[e.jsx(G,{children:e.jsxs(C,{children:[e.jsx(b,{children:"Item"}),e.jsx(b,{children:"Installments"}),u.map(s=>e.jsx(b,{children:s.label},s.value))]})}),e.jsx(J,{children:B})]}),e.jsx("div",{className:"mt-6 text-right",children:e.jsxs("p",{className:"text-md font-semibold",children:["Total Due for ",((y=u.find(s=>s.value===i))==null?void 0:y.label)||"this month",":"," ",e.jsxs("span",{className:"text-primary",children:["₱",x.toFixed(2)]})]})})]})]})};export{te as InstallmentPlanTable};
